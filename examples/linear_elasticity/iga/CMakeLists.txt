PROJECT(perigee)

CMAKE_MINIMUM_REQUIRED(VERSION 3.0)

IF(COMMAND cmake_policy)
  cmake_policy(SET CMP0003 NEW)
  cmake_policy(SET CMP0074 NEW)
ENDIF(COMMAND cmake_policy)

SET(perigee_VERSION_MAJOR 0)
SET(perigee_VERSION_MINOR 0)

SET(CMAKE_BUILD_TYPE Debug CACHE STRING "default to debug" FORCE)
OPTION(BUILD_SHARED_LIBS "build shard libraries" OFF)

# Libraries location
SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)

# binary location
SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR})

INCLUDE(../../../conf/basic_variable_log.cmake)
INCLUDE(../../../conf/system_lib_loading.cmake)

# ===============================================
# Set my own source code
# ===============================================
SET( perigee_source ${perigee_SOURCE_DIR}/../../../src )
# 1. Preprocessor source cpp
SET( perigee_preprocess_lib_src 
  ${perigee_source}/System/Sys_Tools.cpp
  ${perigee_source}/System/Matrix_double_3by3_Array.cpp
  ${perigee_source}/System/kRefinement.cpp
  ${perigee_source}/System/Math_Tools.cpp
  ${perigee_source}/System/HDF5_Writer.cpp
  ${perigee_source}/System/HDF5_Reader.cpp
  ${perigee_source}/Mesh/Tet_Tools.cpp
  ${perigee_source}/NURBS_Tool/NURBS_Bezier.cpp
  ${perigee_source}/NURBS_Tool/NURBS_Tools.cpp
  ${perigee_source}/NURBS_Tool/NURBS_FileIO.cpp
  ${perigee_source}/Postproc_Tool/Vis_Tools.cpp
  ${perigee_source}/Mesh/INodalBC.cpp
  ${perigee_source}/Mesh/IElemBC.cpp
  ${perigee_source}/Mesh/NodalBC_3D_vtp.cpp
  ${perigee_source}/Mesh/NBC_Partition_3D.cpp
  ${perigee_source}/Mesh/EBC_Partition_vtp.cpp
  ${perigee_source}/Mesh/Map_Node_Index.cpp
  ${perigee_source}/Mesh/Global_Part_METIS.cpp
  ${perigee_source}/Mesh/Global_Part_Serial.cpp
  ${perigee_source}/Mesh/Mesh_NURBS_1Patch_3D.cpp
  ${perigee_source}/Mesh/Mesh_NURBS_1Patch_3D_nze.cpp
  ${perigee_source}/Mesh/IEN_NURBS_1Patch_3D_wPtr.cpp
  ${perigee_source}/Mesh/Part_NURBS_1Patch_3D_METIS.cpp
  ${perigee_source}/Mesh/IPart.cpp
  ${perigee_source}/Mesh/EBC_Partition_3D.cpp
  ${perigee_SOURCE_DIR}/../src/NodalBC_3D_Linearelastic.cpp
  ${perigee_SOURCE_DIR}/../src/ElemBC_3D_Linearelastic.cpp
  )

# 2. Anlysis source cpp
SET( perigee_analysis_lib_src
  ${perigee_source}/System/Sys_Tools.cpp
  ${perigee_source}/System/PETSc_Tools.cpp
  ${perigee_source}/System/Matrix_double_3by3_Array.cpp
  ${perigee_source}/System/Matrix_PETSc.cpp
  ${perigee_source}/System/Matrix_3x3.cpp
  ${perigee_source}/System/Matrix_2x2.cpp
  ${perigee_source}/System/Math_Tools.cpp
  ${perigee_source}/System/Tensor4_3D.cpp
  ${perigee_source}/System/Tensor4_2D.cpp
  ${perigee_source}/System/HDF5_PartReader.cpp
  ${perigee_source}/System/HDF5_Writer.cpp
  ${perigee_source}/System/HDF5_Reader.cpp
  ${perigee_source}/Mesh/QuadPts_Gauss.cpp
  ${perigee_source}/Mesh/QuadPts_bc0.cpp
  ${perigee_source}/Mesh/QuadPts_bc1.cpp
  ${perigee_source}/Analysis_Tool/AGlobal_Mesh_Info_FEM_3D.cpp
  ${perigee_source}/Analysis_Tool/APart_Basic_Info.cpp
  ${perigee_source}/Analysis_Tool/ALocal_Elem.cpp
  ${perigee_source}/Analysis_Tool/ALocal_IEN.cpp
  ${perigee_source}/Analysis_Tool/ALocal_NodalBC.cpp
  ${perigee_source}/Analysis_Tool/ALocal_EBC.cpp
  ${perigee_source}/Analysis_Tool/APart_Node.cpp
  ${perigee_source}/Analysis_Tool/ALocal_ElemBC.cpp
  ${perigee_source}/Analysis_Tool/AInt_Weight.cpp
  ${perigee_source}/Analysis_Tool/ALocal_meshSize_3D_NURBS.cpp
  ${perigee_source}/Analysis_Tool/AGlobal_Mesh_Info_1Patch_NURBS_3D.cpp
  ${perigee_source}/Element/AExtractor_3D_NURBS_xyz.cpp
  ${perigee_source}/Element/BernsteinBasis_Array.cpp
  ${perigee_source}/Element/FEANode.cpp
  ${perigee_source}/Element/FEAElement_NURBS_3D_der1.cpp
  ${perigee_source}/Solver/PDNSolution.cpp
  ${perigee_source}/Solver/PGAssem_v360_FEM.cpp
  ${perigee_source}/Solver/PGAssem.cpp
  ${perigee_source}/Solver/PLinear_Solver_PETSc.cpp
  ${perigee_source}/Solver/PGAssem_v360_NURBS.cpp
  ${perigee_SOURCE_DIR}/../src/PDNSolution_LinearElastic_3D.cpp
  ${perigee_SOURCE_DIR}/../src/PDNSolution_Mixed_LinearElastic_3D.cpp
  ${perigee_SOURCE_DIR}/../src/PLocAssem_LinearElastic_3D_Static.cpp
  ${perigee_SOURCE_DIR}/../src/PLocAssem_Mixed_LinearElastic_3D_Static.cpp
  ${perigee_SOURCE_DIR}/../src/PLocAssem_Linear_Elastostatics_3D_IGA.cpp
  )


# 3. Postprocess cpp
SET( perigee_postprocess_lib_src
  ${perigee_source}/Postproc_Tool/PostVectSolution.cpp
  ${perigee_source}/Postproc_Tool/Post_error.cpp
  ${perigee_source}/Postproc_Tool/Vis_Tools.cpp
  ${perigee_source}/Postproc_Tool/Interpolater.cpp
  ${perigee_source}/Mesh/QuadPts_vis.cpp
  ${perigee_source}/Mesh/QuadPts_Gauss.cpp
  ${perigee_source}/Analysis_Tool/AInt_Weight.cpp
  ${perigee_source}/Element/FEAElement_NURBS_2D_der0.cpp
  ${perigee_source}/Element/FEAElement_NURBS_3D_der0_v3.cpp
  ${perigee_source}/Element/FEAElement_NURBS_3D_der1_v3.cpp
  ${perigee_source}/Postproc_Tool/VTK_Writer.cpp
  ${perigee_SOURCE_DIR}/../src/VisDataPrep_LinearElastic_3D.cpp
  ${perigee_SOURCE_DIR}/../src/VTK_Writer_LE_Tet4.cpp
  ${perigee_SOURCE_DIR}/../src/Post_error_tet4_le.cpp
  )

SET( perigee_hex_aux_tool_lib_src
  ${perigee_source}/NURBS_Tool/NURBS_Bezier.cpp
  ${perigee_source}/NURBS_Tool/NURBS_Tools.cpp
  ${perigee_source}/NURBS_Tool/NURBS_FileIO.cpp
  ${perigee_source}/System/Sys_Tools.cpp
  ${perigee_source}/System/kRefinement.cpp
  ${perigee_source}/Mesh/Mesh_NURBS_1Patch_3D.cpp
  ${perigee_source}/Mesh/Mesh_NURBS_1Patch_3D_nze.cpp
  ${perigee_source}/Mesh/IEN_NURBS_1Patch_3D_wPtr.cpp
  )

# ===============================================
# Finish setting my own source code
# ===============================================
# INCLUDE MY OWN HEADER FILES
INCLUDE_DIRECTORIES( ../../../include )
INCLUDE_DIRECTORIES( ../include )

# -------------------------------------------------------------------
# MAKE MY OWN LIBRARIES
# 1. Preprocess libs
ADD_LIBRARY( perigee_preprocess ${perigee_preprocess_lib_src} )
TARGET_LINK_LIBRARIES( perigee_preprocess ${EXTRA_LINK_LIBS} )

# 2. Analysis libs
ADD_LIBRARY( perigee_analysis ${perigee_analysis_lib_src} )
TARGET_LINK_LIBRARIES( perigee_analysis ${EXTRA_LINK_LIBS} )

# 3. Postprocess lib
ADD_LIBRARY( perigee_postprocess ${perigee_postprocess_lib_src} )
TARGET_LINK_LIBRARIES( perigee_postprocess ${EXTRA_LINK_LIBS} perigee_analysis )

ADD_LIBRARY( perigee_hexlib ${perigee_hex_aux_tool_lib_src} )
TARGET_LINK_LIBRARIES( perigee_hexlib ${EXTRA_LINK_LIBS} perigee_analysis )
# -------------------------------------------------------------------

# ===================================================================
# BUILD THE MAIN DRIVERS
# ===================================================================
# 1. Make executable
# 1.1 Preprocess
ADD_EXECUTABLE( preprocess3d_iga preprocess3d_iga_main.cpp)

# 1.2 Analysis and tests
ADD_EXECUTABLE( leiga3d le3d_iga_driver.cpp)

# 1.3 Post-process
ADD_EXECUTABLE( prepostproc_iga prepost.cpp)
ADD_EXECUTABLE( manu_compare_iga post_compare_manu_iga.cpp )
ADD_EXECUTABLE( visle_iga3d vis_ela_iga.cpp )

# -------------------------------------------------------------------
# 2. Link libraries
# 2.1 Preprocess
TARGET_LINK_LIBRARIES( preprocess3d_iga ${EXTRA_LINK_LIBS} perigee_preprocess )

# 2.2 Analysis and tests
TARGET_LINK_LIBRARIES( leiga3d ${EXTRA_LINK_LIBS} perigee_analysis )

# 2.3 Postprocess
TARGET_LINK_LIBRARIES( prepostproc_iga ${EXTRA_LINK_LIBS} perigee_analysis 
  perigee_preprocess )

TARGET_LINK_LIBRARIES( visle_iga3d ${EXTRA_LINK_LIBS} perigee_postprocess )
TARGET_LINK_LIBRARIES( manu_compare_iga ${EXTRA_LINK_LIBS} perigee_postprocess )

#EOF
